<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pomodoro Timer</title>
  <style>
    :root {
      --bg-color: #f0f0f0;
      --text-color: #333;
      --btn-color: #4CAF50;
      --btn-hover-color: #45a049;
      --highlight-color: #ff9800;
      --highlight-text-color: #fff;
      --btn-text-color: #fff;
      --timer-color: #000;
      --timer-font: 'Arial', sans-serif;
      --timer-font-size: 48px;
      --btn-font-size: 16px;
    }

    *, *::before, *::after { box-sizing: border-box; }

    body {
      font-family: var(--timer-font);
      background-color: var(--bg-color);
      color: var(--text-color);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      margin: 0;
    }

    #timer {
      font-size: var(--timer-font-size);
      color: var(--timer-color);
      margin-bottom: 20px;
      text-align: center;
    }

    .tabs, .button-container, .apply-btn-wrapper {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
    }

    .tab, .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 25px;
      background-color: var(--btn-color);
      color: var(--btn-text-color);
      font-size: var(--btn-font-size);
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .tab.active, .section-button {
      background-color: var(--highlight-color);
      color: var(--highlight-text-color);
    }

    .tab:hover, .btn:hover {
      background-color: var(--btn-hover-color);
    }

    .btn:active {
      transform: scale(0.98);
    }

    .section-button {
      background: #fff;
      color: var(--highlight-color);
      border: 1px solid var(--highlight-color);
      width: 100%;
      text-align: left;
      margin: 5px 0;
      border-radius: 8px;
      padding: 10px;
    }

    .section-content {
      display: none;
      background: #f9f9f9;
      border: 1px solid #ddd;
      padding: 10px;
      margin-top: 10px;
      border-radius: 8px;
    }

    .section-content.visible {
      display: block;
    }

    #optionsPanel {
      width: 100%;
      max-width: 400px;
      overflow: hidden;
      transition: max-height 0.5s ease, opacity 0.5s ease;
      max-height: 0;
      opacity: 0;
    }

    #optionsPanel.open {
      max-height: 1000px;
      opacity: 1;
    }

    .option-group {
      margin: 10px 0;
    }

    .option-group label {
      display: inline-block;
      margin-bottom: 5px;
    }

    .option-group input {
      width: 100%;
      padding: 5px;
    }
  </style>
</head>
<body>

<div id="pomodoroApp">
  <div class="tabs">
    <button class="tab pomodoro active" onclick="switchMode('pomodoro')">𝐏𝐨𝐦𝐨𝐝𝐨𝐫𝐨</button>
    <button class="tab short" onclick="switchMode('short')">𝐒𝐡𝐨𝐫𝐭 𝐁𝐫𝐞𝐚𝐤</button>
    <button class="tab long" onclick="switchMode('long')">𝐋𝐨𝐧𝐠 𝐁𝐫𝐞𝐚𝐤</button>
  </div>

  <div id="timer">00:00</div>

  <div class="button-container">
    <button id="startBtn" class="btn" onclick="toggleTimer()">𝚂𝚃𝙰𝚁𝚃</button>
    <button class="btn" onclick="resetTimer()">𝚁𝙴𝚂𝙴𝚃</button>
    <button class="btn" onclick="toggleOptions()">໒꒱ ‧₊˚</button>
  </div>
</div>

<!-- 옵션 패널 -->
<div id="optionsPanel">
  <button class="section-button" onclick="toggleSection('timeSettings')">시간 설정</button>
  <div id="timeSettings" class="section-content">
    <div class="option-group"><label>Pomodoro 시간 (분):</label><input type="number" id="pomodoroTime" value="25"></div>
    <div class="option-group"><label>짧은 휴식 (분):</label><input type="number" id="shortTime" value="5"></div>
    <div class="option-group"><label>긴 휴식 (분):</label><input type="number" id="longTime" value="15"></div>
  </div>

  <button class="section-button" onclick="toggleSection('colorSettings')">색상 설정</button>
  <div id="colorSettings" class="section-content">
    <div class="option-group"><label>배경 색상:</label><input type="color" id="bgColor" value="#f0f0f0"></div>
    <div class="option-group"><label>버튼 색상:</label><input type="color" id="btnColor" value="#4CAF50"></div>
    <div class="option-group"><label>버튼 호버 색상:</label><input type="color" id="btnHoverColor" value="#45a049"></div>
    <div class="option-group"><label>강조 색상:</label><input type="color" id="highlightColor" value="#ff9800"></div>
    <div class="option-group"><label>버튼 텍스트 색상:</label><input type="color" id="btnTextColor" value="#ffffff"></div>
    <div class="option-group"><label>타이머 색상:</label><input type="color" id="timerColor" value="#000000"></div>
  </div>

  <button class="section-button" onclick="toggleSection('textSettings')">텍스트 설정</button>
  <div id="textSettings" class="section-content">
    <div class="option-group"><label>버튼 글자 크기 (px):</label><input type="number" id="btnFontSize" value="16"></div>
    <div class="option-group"><label>타이머 글자 크기 (px):</label><input type="number" id="timerFontSize" value="48"></div>
    <div class="option-group"><label>작업 완료 메시지:</label><input type="text" id="workDoneMessage" value="작업 끝!"></div>
    <div class="option-group"><label>휴식 완료 메시지:</label><input type="text" id="breakDoneMessage" value="휴식 끝!"></div>
  </div>

  <button class="section-button" onclick="toggleSection('soundSettings')">사운드 설정</button>
  <div id="soundSettings" class="section-content">
    <div class="option-group"><label>볼륨:</label><input type="range" id="volumeControl" min="0" max="1" step="0.01" value="1"></div>
  </div>

  <div class="apply-btn-wrapper">
    <button class="btn" onclick="applyOptions()">적용</button>
    <button class="btn" onclick="toggleOptions()">닫기</button>
  </div>
</div>

<audio id="alarmSound" loop>
  <source src="https://raw.githubusercontent.com/chasw930/Pomodoro-Timer/main/prod.chibi-wind.mp3" type="audio/mp3">
</audio>

<script>
  let timerInterval, timeLeft, isRunning = false, currentMode = 'pomodoro';
  const alarm = document.getElementById('alarmSound');
  const volumeControl = document.getElementById('volumeControl');

  volumeControl.addEventListener('input', () => {
    alarm.volume = parseFloat(volumeControl.value);
    localStorage.setItem('userVolume', volumeControl.value);
  });

  function switchMode(mode) {
    currentMode = mode;
    timeLeft = getDuration(mode) * 60;
    updateTimerDisplay();
    document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
    document.querySelector(`.tab.${mode}`).classList.add('active');
    stopTimer();
    alarm.pause();
    alarm.currentTime = 0;
  }

  function toggleTimer() {
    if (isRunning) stopTimer();
    else startTimer();
  }

  function startTimer() {
    isRunning = true;
    document.getElementById('startBtn').innerText = '𝙿𝙰𝚄𝚂𝙴';
    if (!timeLeft) timeLeft = getDuration(currentMode) * 60;
    timerInterval = setInterval(updateTimer, 1000);
  }

  function stopTimer() {
    clearInterval(timerInterval);
    isRunning = false;
    document.getElementById('startBtn').innerText = '𝚂𝚃𝙰𝚁𝚃';
  }

  function updateTimer() {
    if (timeLeft <= 0) {
      stopTimer();
      alarm.play();
      setTimeout(() => {
        const { work = '작업 완료!', break: brk = '휴식 끝!' } = JSON.parse(localStorage.getItem('userMessages') || '{}');
        alert(currentMode === 'pomodoro' ? work : brk);
      }, 300);
    } else {
      timeLeft--;
      updateTimerDisplay();
    }
  }

  function updateTimerDisplay() {
    const minutes = String(Math.floor(timeLeft / 60)).padStart(2, '0');
    const seconds = String(timeLeft % 60).padStart(2, '0');
    document.getElementById('timer').innerText = `${minutes}:${seconds}`;
  }

  function resetTimer() {
    stopTimer();
    timeLeft = getDuration(currentMode) * 60;
    updateTimerDisplay();
    alarm.pause();
    alarm.currentTime = 0;
  }

  function toggleOptions() {
    document.getElementById('optionsPanel').classList.toggle('open');
  }

  function toggleSection(id) {
    document.getElementById(id).classList.toggle('visible');
  }

  function applyOptions() {
    const styleInputs = {
      '--bg-color': 'bgColor', '--btn-color': 'btnColor', '--btn-hover-color': 'btnHoverColor',
      '--highlight-color': 'highlightColor', '--btn-text-color': 'btnTextColor', '--timer-color': 'timerColor',
      '--btn-font-size': 'btnFontSize', '--timer-font-size': 'timerFontSize'
    };

    let updatedStyles = {};
    for (const variable in styleInputs) {
      const input = document.getElementById(styleInputs[variable]);
      if (input) {
        const value = input.type === 'number' ? `${input.value}px` : input.value;
        document.documentElement.style.setProperty(variable, value);
        updatedStyles[variable] = value;
      }
    }

    localStorage.setItem('userStyles', JSON.stringify(updatedStyles));
    localStorage.setItem('userTimes', JSON.stringify({
      pomodoro: +document.getElementById('pomodoroTime').value,
      short: +document.getElementById('shortTime').value,
      long: +document.getElementById('longTime').value
    }));
    localStorage.setItem('userMessages', JSON.stringify({
      work: document.getElementById('workDoneMessage').value,
      break: document.getElementById('breakDoneMessage').value
    }));

    resetTimer();
  }

  function getDuration(mode) {
    const saved = JSON.parse(localStorage.getItem('userTimes') || '{}');
    return mode === 'pomodoro' ? (saved.pomodoro || 25) :
           mode === 'short' ? (saved.short || 5) : (saved.long || 15);
  }

  function loadUserSettings() {
    const styleMap = JSON.parse(localStorage.getItem('userStyles') || '{}');
    for (const variable in styleMap) {
      document.documentElement.style.setProperty(variable, styleMap[variable]);
      const inputId = {
        '--bg-color': 'bgColor', '--btn-color': 'btnColor', '--btn-hover-color': 'btnHoverColor',
        '--highlight-color': 'highlightColor', '--btn-text-color': 'btnTextColor',
        '--timer-color': 'timerColor', '--btn-font-size': 'btnFontSize', '--timer-font-size': 'timerFontSize'
      }[variable];
      if (inputId) {
        const input = document.getElementById(inputId);s
        if (input) input.value = styleMap[variable].replace('px', '');
      }
    }

    const times = JSON.parse(localStorage.getItem('userTimes') || '{}');
    document.getElementById('pomodoroTime').value = times.pomodoro || 25;
    document.getElementById('shortTime').value = times.short || 5;
    document.getElementById('longTime').value = times.long || 15;

    const messages = JSON.parse(localStorage.getItem('userMessages') || '{}');
    document.getElementById('workDoneMessage').value = messages.work || '작업 끝!';
    document.getElementById('breakDoneMessage').value = messages.break || '휴식 끝!';
  }

  document.addEventListener('DOMContentLoaded', () => {
    loadUserSettings();
    switchMode(currentMode);
    const savedVolume = localStorage.getItem('userVolume');
    if (savedVolume !== null) {
      volumeControl.value = savedVolume;
      alarm.volume = parseFloat(savedVolume);
    }
  });
</script>

</body>
</html>
